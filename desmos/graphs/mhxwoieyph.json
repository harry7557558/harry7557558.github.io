{"hash":"mhxwoieyph","parent_hash":"ibkb6mh0o6","thumbUrl":"https://saved-work.desmos.com/calc_thumbs/production/mhxwoieyph.png","stateUrl":"https://saved-work.desmos.com/calc-states/production/mhxwoieyph","title":"Raymarching Gradient Estimation","access":"link","created":"Fri, 24 Jun 2022 01:17:10 GMT","state":{"version":9,"randomSeed":"84875bce01d5c021d1e6a8d6b24b587d","graph":{"viewport":{"xmin":-2.363228081203586,"ymin":-2.730323593593637,"xmax":7.903017991966223,"ymax":3.759081555166357}},"expressions":{"list":[{"type":"text","id":"90","text":"Try to develop a fast-converging method for intersecting a ray with an implicit surface. The value of the scalar field along the ray can be viewed as a one-dimensional function, and the problem is to find the first zero of the function with a positive parameter.\n\nThe idea is to approximate the distance field by dividing the function by its gradient and perform raymarching. This graph tests two ways to approximate the gradient by only evaluating the function at raymarching sample points.\n\n[eg, black]: the exact gradient, for reference.\n\n[se, green]: gradient approximated from two previous value samples and two previous gradients. Unstable and \"blows off.\"\n\n[fd, red]: gradient approximated from three previous value samples. This appears to be the best way."},{"type":"folder","id":"2","title":"Test functions","collapsed":true},{"type":"expression","id":"3","folderId":"2","color":"#2d70b3","latex":"u_{1}\\left(x\\right)=\\sqrt{\\left(x-2\\pi\\right)^{2}+2}-1.5","hidden":true},{"type":"expression","id":"4","folderId":"2","color":"#388c46","latex":"u_{2}\\left(x\\right)=\\left(x-5.8\\right)\\left(x-6.2\\right)","hidden":true,"labelSize":"medium"},{"type":"expression","id":"7","folderId":"2","color":"#c74440","latex":"u_{3}\\left(x\\right)=u_{1}\\left(x\\right)-0.2\\sin\\left(5x\\right)","hidden":true},{"type":"expression","id":"8","folderId":"2","color":"#2d70b3","latex":"u_{4}\\left(x\\right)=u_{1}\\left(x\\right)+0.2\\tan\\left(4x\\right)^{2}-0.1","hidden":true},{"type":"expression","id":"9","folderId":"2","color":"#388c46","latex":"u_{5}\\left(x\\right)=0.99-\\operatorname{sech}\\left(x-2\\pi\\right)^{2}","hidden":true},{"type":"expression","id":"10","folderId":"2","color":"#6042a6","latex":"u_{6}\\left(x\\right)=\\left(x-2\\pi\\right)^{6}-\\left(x-2\\pi\\right)^{3}+0.01","hidden":true},{"type":"expression","id":"11","folderId":"2","color":"#000000","latex":"u_{7}\\left(x\\right)=\\ln\\left(10\\left|x-2\\pi\\right|\\right)","hidden":true},{"type":"expression","id":"85","folderId":"2","color":"#388c46","latex":"u_{8}\\left(x\\right)=\\min\\left(u_{1}\\left(x\\right),\\sqrt{x^{2}+0.1}\\right)","hidden":true},{"type":"expression","id":"86","folderId":"2","color":"#6042a6","latex":"u_{9}\\left(x\\right)=u_{8}\\left(x\\right)+0.02\\sin\\left(40x\\right)","hidden":true},{"type":"expression","id":"91","folderId":"2","color":"#388c46","latex":"u_{10}\\left(x\\right)=-u_{8}\\left(x\\right)","hidden":true},{"type":"expression","id":"13","color":"#2d70b3","latex":"v\\left(x\\right)=u_{8}\\left(x\\right)"},{"type":"expression","id":"33","color":"#c74440","latex":"v'\\left(x\\right)","labelSize":"medium"},{"type":"expression","id":"25","color":"#388c46","latex":"s_{tepMin}=0.001","labelSize":"medium","slider":{"hardMin":true,"hardMax":true,"min":"0","max":"0.1"}},{"type":"expression","id":"26","color":"#6042a6","latex":"s_{tepMax}=0.5","slider":{"hardMax":true,"max":"1"}},{"type":"expression","id":"27","color":"#000000","latex":"c_{lamp}\\left(x\\right)=\\min\\left(\\max\\left(x,s_{tepMin}\\right),s_{tepMax}\\right)","hidden":true},{"type":"folder","id":"15","title":"[eg] Divide by the exact gradient.","collapsed":true},{"type":"expression","id":"17","folderId":"15","color":"#000000","latex":"H_{eg}=\\left[\\left(0.5,0.5916079783099616\\right),\\left(0.5,0.8451542547285166\\right),\\left(1,1.0488088481701516\\right),\\left(1,0.9534625892455922\\right),\\left(1.5,1.5329709716755893\\right),\\left(1.5,0.9784921095801632\\right),\\left(2,2.0248456731316584\\right),\\left(2,0.9877295966495897\\right),\\left(2.5,2.5199206336708304\\right),\\left(2.5,0.9920947376656813\\right),\\left(3,2.07481548632652\\right),\\left(3,-0.9184209142367197\\right),\\left(3.5,1.6218777128677426\\right),\\left(3.5,-0.8915100343962432\\right),\\left(4,1.1856908137238622\\right),\\left(4,-0.850129618611541\\right),\\left(4.5,0.7759063776309332\\right),\\left(4.5,-0.7835055627533164\\right),\\left(5,0.4095980028690773\\right),\\left(5,-0.6719661966820573\\right),\\left(5.5,0.11659494784005275\\right),\\left(5.5,-0.48446601186401533\\right),\\left(5.740666930155628,0.014703333794677365\\right),\\left(5.740666930155628,-0.35816807484329344\\right),\\left(5.781718421975803,0.0004895990829074659\\right),\\left(5.781718421975803,-0.334202173417448\\right)\\right]","labelSize":"medium"},{"type":"expression","id":"18","folderId":"15","color":"#c74440","latex":"x_{eg}=5.781718421975803","labelSize":"medium","slider":{"hardMin":true,"min":"0"}},{"type":"expression","id":"19","folderId":"15","color":"#2d70b3","latex":"v_{eg1}=0.0004895990829074659","labelSize":"medium"},{"type":"expression","id":"20","folderId":"15","color":"#388c46","latex":"g_{eg1}=-0.334202173417448"},{"type":"expression","id":"23","folderId":"15","color":"#c74440","latex":"r_{esetEg}=H_{eg}\\to\\left[\\right],\\ x_{eg}\\to0,\\ v_{eg1}\\to v\\left(0\\right),\\ g_{eg1}\\to v'\\left(0\\right)"},{"type":"expression","id":"32","folderId":"15","color":"#000000","latex":"h_{eg}=c_{lamp}\\left(\\left|\\frac{v_{eg1}}{g_{eg1}}\\right|\\right)"},{"type":"expression","id":"28","folderId":"15","color":"#c74440","latex":"x_{1eg}=x_{eg}+h_{eg}","labelSize":"medium"},{"type":"expression","id":"24","folderId":"15","color":"#2d70b3","latex":"u_{pdateEg0}=x_{eg}\\to x_{1eg},\\ v_{eg1}\\to v\\left(x_{1eg}\\right),\\ g_{eg1}\\to v'\\left(x_{1eg}\\right)"},{"type":"expression","id":"30","folderId":"15","color":"#388c46","latex":"u_{pdateEg}=\\left\\{v_{eg1}v\\left(x_{1eg}\\right)>0:\\ \\left(u_{pdateEg0},\\ H_{eg}\\to\\operatorname{join}\\left(H_{eg},\\left[\\left(x_{1eg},v\\left(x_{1eg}\\right)\\right),\\left(x_{1eg},v'\\left(x_{1eg}\\right)\\right)\\right]\\right)\\right)\\right\\}"},{"type":"folder","id":"35","title":"[se] Divide by the gradient projected by setting the series expansion to zero. Unstable.","collapsed":true},{"type":"expression","id":"36","folderId":"35","color":"#388c46","latex":"H_{se}=\\left[\\left(0.5,0.5916079783099616\\right),\\left(0.5,0.5507604245862473\\right),\\left(1,1.0488088481701516\\right),\\left(1,0.5507604245862479\\right),\\left(1.5,1.5329709716755893\\right),\\left(1.5,-3.8129353570233424\\right),\\left(1.9020448363625915,1.9281531473235205\\right),\\left(1.9020448363625915,-29.94675572348279\\right),\\left(1.9664308808853228,1.9916953605658239\\right),\\left(1.9664308808853228,-54.044699193024535\\right),\\left(2.003283622972985,2.0280890695607448\\right),\\left(2.003283622972985,-299.9388844010969\\right),\\left(2.0100452973507847,2.034768315411365\\right),\\left(2.0100452973507847,-576.9363023033052\\right),\\left(2.0135721482479947,2.038252387757719\\right),\\left(2.0135721482479947,-2813.9294274442304\\right),\\left(2.0145721482479946,2.0392402851298663\\right),\\left(2.0145721482479946,-7152.510008934905\\right),\\left(2.0155721482479945,2.0402281942942153\\right),\\left(2.0155721482479945,-71301.58197716616\\right),\\left(2.0165721482479944,2.0412161152336443\\right),\\left(2.0165721482479944,-606187.060771976\\right),\\left(2.0175721482479942,2.042204047931065\\right),\\left(2.0175721482479942,-5206016.251112913\\right),\\left(2.018572148247994,2.0431919923694206\\right),\\left(2.018572148247994,-44679077.167955555\\right)\\right]"},{"type":"expression","id":"39","folderId":"35","color":"#c74440","latex":"x_{se}=2.018572148247994"},{"type":"expression","id":"40","folderId":"35","color":"#2d70b3","latex":"v_{se1}=2.0431919923694206"},{"type":"expression","id":"41","folderId":"35","color":"#388c46","latex":"v_{se0}=2.042204047931065"},{"type":"expression","id":"42","folderId":"35","color":"#6042a6","latex":"g_{se1}=-44679077.167955555"},{"type":"expression","id":"43","folderId":"35","color":"#000000","latex":"g_{se0}=-5206016.251112913"},{"type":"expression","id":"49","folderId":"35","color":"#c74440","latex":"h_{se0}=0.001"},{"type":"expression","id":"44","folderId":"35","color":"#c74440","latex":"r_{esetSe}=H_{se}\\to\\left[\\right],\\ x_{se}\\to0,\\ v_{se1}\\to v\\left(0\\right),\\ v_{se0}\\to v\\left(0\\right),\\ g_{se1}\\to0,\\ g_{se0}\\to0,\\ h_{se0}\\to s_{tepMax}"},{"type":"expression","id":"45","folderId":"35","color":"#2d70b3","latex":"h_{se}=\\left\\{\\operatorname{length}\\left(H_{se}\\right)=0:\\ s_{tepMax},\\ c_{lamp}\\left(\\left|\\frac{v_{se1}}{g_{se1}}\\right|\\right)\\right\\}"},{"type":"expression","id":"46","folderId":"35","color":"#388c46","latex":"x_{1se}=x_{se}+h_{se}"},{"type":"expression","id":"47","folderId":"35","color":"#6042a6","latex":"v_{1se}=v\\left(x_{1se}\\right)"},{"type":"text","id":"62","folderId":"35","text":"Setting the low-order terms of the series expansion to zero. Unstable.\nhttps://www.desmos.com/calculator/casiwyvoa1"},{"type":"expression","id":"59","folderId":"35","color":"#000000","latex":"g_{1ser0}=A_{se}v_{se1}+B_{se}v_{se0}+C_{se}g_{se1}+D_{se}g_{se0}"},{"type":"expression","id":"50","folderId":"35","color":"#2d70b3","latex":"B_{se}=\\frac{12}{h_{se0}^{4}}\\left(\\frac{1}{2}h_{se}h_{se0}^{2}+\\frac{1}{2}h_{se}^{2}h_{se0}\\right)"},{"type":"expression","id":"51","folderId":"35","color":"#388c46","latex":"D_{se}=\\frac{12}{h_{se0}^{4}}\\left(\\frac{1}{4}h_{se}^{2}h_{se0}^{2}+\\frac{1}{6}h_{se}h_{se0}^{3}\\right)"},{"type":"expression","id":"52","folderId":"35","color":"#6042a6","latex":"A_{se}=-B_{se}"},{"type":"expression","id":"53","folderId":"35","color":"#000000","latex":"C_{se}=1+B_{se}h_{se0}-D_{se}"},{"type":"expression","id":"48","folderId":"35","color":"#000000","latex":"g_{1se}=\\left\\{\\operatorname{length}\\left(H_{se}\\right)=0:\\ \\frac{v_{1se}-v_{se0}}{h_{se0}},\\ g_{1ser0}\\right\\}","labelSize":"medium"},{"type":"expression","id":"54","folderId":"35","color":"#c74440","latex":"u_{pdateSe0}=x_{se}\\to x_{1se},\\ v_{se1}\\to v\\left(x_{1se}\\right),\\ g_{se1}\\to g_{1se},\\ v_{se0}\\to v_{se1},\\ g_{se0}\\to\\left\\{\\operatorname{length}\\left(H_{se}\\right)=0:g_{1se},g_{se1}\\right\\},\\ h_{se0}\\to h_{se}"},{"type":"expression","id":"55","folderId":"35","color":"#2d70b3","latex":"u_{pdateSe}=\\left\\{v_{se1}v\\left(x_{1se}\\right)>0:\\ \\left(u_{pdateSe0},\\ H_{se}\\to\\operatorname{join}\\left(H_{se},\\left[\\left(x_{1se},v\\left(x_{1se}\\right)\\right),\\left(x_{1se},g_{1se}\\right)\\right]\\right)\\right)\\right\\}"},{"type":"folder","id":"67","title":"[fd] Finite difference that depends only on the value.","collapsed":true},{"type":"expression","id":"68","folderId":"67","color":"#c74440","latex":"H_{fd}=\\left[\\left(0.5,0.5916079783099616\\right),\\left(0.5,0.5507604245862473\\right),\\left(1,1.0488088481701516\\right),\\left(1,1.0962223972874465\\right),\\left(1.5,1.5329709716755893\\right),\\left(1.5,0.9952855006561228\\right),\\left(2,2.0248456731316584\\right),\\left(2,0.9914619808627698\\right),\\left(2.5,2.5199206336708304\\right),\\left(2.5,0.993350180161447\\right),\\left(3,2.07481548632652\\right),\\left(3,-1.8303904025721032\\right),\\left(3.5,1.6218777128677426\\right),\\left(3.5,-0.9137081730320222\\right),\\left(4,1.1856908137238622\\right),\\left(4,-0.8556229239728643\\right),\\left(4.5,0.7759063776309332\\right),\\left(4.5,-0.7931664091349067\\right),\\left(5,0.4095980028690773\\right),\\left(5,-0.6891406881926385\\right),\\left(5.5,0.11659494784005275\\right),\\left(5.5,-0.5127007903252179\\right),\\left(5.72741323992517,0.019500770233515707\\right),\\left(5.72741323992517,-0.37722438982995854\\right),\\left(5.779108651884895,0.001363804816501668\\right),\\left(5.779108651884895,-0.3367464987046667\\right)\\right]"},{"type":"expression","id":"69","folderId":"67","color":"#2d70b3","latex":"x_{fd}=5.779108651884895"},{"type":"expression","id":"70","folderId":"67","color":"#388c46","latex":"v_{fd}=0.001363804816501668"},{"type":"expression","id":"71","folderId":"67","color":"#6042a6","latex":"v_{fd0}=0.019500770233515707"},{"type":"expression","id":"72","folderId":"67","color":"#000000","latex":"v_{fd00}=0.11659494784005275"},{"type":"expression","id":"73","folderId":"67","color":"#c74440","latex":"h_{fd0}=0.051695411959725275"},{"type":"expression","id":"74","folderId":"67","color":"#2d70b3","latex":"h_{fd00}=0.22741323992516943","labelSize":"medium"},{"type":"expression","id":"76","folderId":"67","color":"#6042a6","latex":"r_{esetFd}=H_{fd}\\to\\left[\\right],\\ x_{fd}\\to0,\\ v_{fd}\\to v\\left(0\\right),\\ v_{fd0}\\to v\\left(0\\right),\\ v_{fd00}\\to v\\left(0\\right),\\ h_{fd0}\\to0,\\ h_{fd00}\\to0"},{"type":"expression","id":"82","folderId":"67","color":"#000000","latex":"g_{fdf2}\\left(v_{1},v_{0},v_{00},h_{0},h_{00}\\right)=v_{00}\\cdot\\frac{h_{0}}{h_{00}\\left(h_{0}+h_{00}\\right)}-v_{0}\\cdot\\frac{h_{0}+h_{00}}{h_{0}h_{00}}+v_{1}\\cdot\\frac{2h_{0}+h_{00}}{h_{0}\\left(h_{0}+h_{00}\\right)}"},{"type":"expression","id":"83","folderId":"67","color":"#c74440","latex":"g_{fdf1}\\left(v_{1},v_{0},h_{0}\\right)=\\frac{v_{1}-v_{0}}{h_{0}}"},{"type":"expression","id":"84","folderId":"67","color":"#2d70b3","latex":"g_{fdf}\\left(v_{1},v_{0},v_{00},h_{0},h_{00}\\right)=\\left\\{h_{0}>0:\\left\\{h_{00}>0:g_{fdf2}\\left(v_{1},v_{0},v_{00},h_{0},h_{00}\\right),g_{fdf1}\\left(v_{1},v_{0},h_{0}\\right)\\right\\},10^{-12}\\right\\}"},{"type":"expression","id":"80","folderId":"67","color":"#388c46","latex":"g_{fd}=g_{fdf}\\left(v_{fd},v_{fd0},v_{fd00},h_{fd0},h_{fd00}\\right)"},{"type":"expression","id":"75","folderId":"67","color":"#388c46","latex":"h_{fd}=\\left\\{\\operatorname{length}\\left(H_{fd}\\right)=0:\\ s_{tepMax},\\ c_{lamp}\\left(\\left|\\frac{v_{fd}}{g_{fd}}\\right|\\right)\\right\\}"},{"type":"expression","id":"78","folderId":"67","color":"#c74440","latex":"x_{1fd}=x_{fd}+h_{fd}"},{"type":"expression","id":"81","folderId":"67","color":"#6042a6","latex":"g_{1fd}=g_{fdf}\\left(v\\left(x_{1fd}\\right),v_{fd},v_{fd0},h_{fd},h_{fd0}\\right)"},{"type":"expression","id":"77","folderId":"67","color":"#000000","latex":"u_{pdateFd0}=x_{fd}\\to x_{1fd},\\ v_{fd}\\to v\\left(x_{1fd}\\right),\\ v_{fd0}\\to v_{fd},\\ v_{fd00}\\to v_{fd0},\\ h_{fd0}\\to h_{fd},\\ h_{fd00}\\to h_{fd0}"},{"type":"expression","id":"79","folderId":"67","color":"#2d70b3","latex":"u_{pdateFd}=\\left\\{v_{fd}v\\left(x_{1fd}\\right)>0:\\ \\left(u_{pdateFd0},\\ H_{fd}\\to\\operatorname{join}\\left(H_{fd},\\left[\\left(x_{1fd},v\\left(x_{1fd}\\right)\\right),\\left(x_{1fd},g_{1fd}\\right)\\right]\\right)\\right)\\right\\}","labelSize":"medium"},{"type":"folder","id":"dsm-metadata-folder","title":"DesModder Metadata","secret":true},{"type":"text","id":"dsm-metadata","folderId":"dsm-metadata-folder","text":"{\"version\":2,\"expressions\":{\"11\":{\"errorHidden\":true},\"28\":{\"errorHidden\":true}}}"},{"type":"expression","id":"37","color":"#6042a6","latex":"r_{eset}=r_{esetEg},\\ r_{esetSe},\\ r_{esetFd}"},{"type":"expression","id":"38","color":"#000000","latex":"u_{pdate}=u_{pdateEg},\\ u_{pdateSe},\\ u_{pdateFd}"}]}}}